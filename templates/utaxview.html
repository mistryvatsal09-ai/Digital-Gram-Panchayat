<!DOCTYPE html>

<html lang="en">
<!--<![endif]-->
{% load static %}
{% include 'uhead.html' %}

{% if request.session.userid == None %}
<script type="text/javascript">window.location.href="usignin";</script>
{% endif %}

<style>
    .table-responsive {
        margin: 20px 0;
    }
    
    .table {
        width: 100%;
        border-collapse: collapse;
        text-align: left;
    }
    
    .table thead {
        background-color: #f4f4f4;
    }
    
    .table th, .table td {
        border: 1px solid #ddd;
        padding: 10px;
    }
    
    .table th {
        font-weight: bold;
       
        /* text-transform: uppercase; */
    }
    
    .table tr:nth-child(even) {
        background-color: #f9f9f9;
    }
    
    .table tr:hover {
        background-color: #f1f1f1;
    }
    
    .btn {
        color: #fff;
        border: none;
        padding: 5px 10px;
        text-decoration: none;
        border-radius: 4px;
    }
    
    .btn-primary {
        background-color: #007bff;
    }
    
    .btn-primary:hover {
        background-color: #0056b3;
    }
    
    .btn-warning {
        background-color: #ffc107;
    }
    
    .btn-warning:hover {
        background-color: #e0a800;
    }
    
    .btn-danger {
        background-color: #dc3545;
    }
    
    .btn-danger:hover {
        background-color: #c82333;
    }
    
    .btn-success {
        background-color: #28a745;
        padding: 8px 12px;
        font-size: 14px;
    }
    
    .btn-success:hover {
        background-color: #218838;
    }
    
    .d-flex {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .mb-3 {
        margin-bottom: 1rem;
    }

     /* Modal styles */
     .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.7) !important; /* Darken the backdrop */
        }
        
        .modal-dialog {
            max-width: 400px; /* Adjust modal width */
            margin: 10% auto; /* Center the modal vertically */
        }

        .modal-content {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        #error-message {
            color: red;
            display: none;
            font-size: 14px;
            position: absolute;
        }
    </style>

<body>
	<!-- preloader Start -->
    
	<!-- Top Scroll End -->
	<!-- Top Header Wrapper Start -->
	{% include 'uheader.html' %}
	<!-- Top Header Wrapper End -->
	<!-- Header Wrapper Start -->
	
	<!-- Header Wrapper End -->
	<!-- map Wrapper Start -->
	{% include 'ubanner.html' %}
	<!-- map Wrapper End -->
	<!--start-->
    
    <div class="register_section">

        <div class="register_tab_wrapper">

            <div class="container">
                <div class="table-responsive" style="margin-left:-139px; margin-right: -139px;">
                    
                    <table class="table table-striped table-bordered">
                        <thead>
                            <tr>
                                <th style="width: 2%;">ID</th>
                                <th style="width: 5%;">Name Of Applicant</th>
                                <th style="width: 6%;">Tax Amount</th>
                                <th style="width: 6%;">Outstanding Amount</th>
                                <th style="width: 6%;">Total Amount</th>
                                <th style="width: 5%;">Tax Year</th>
                                <th style="width: 5%;">Issue Date</th>
                                <th style="width: 5%;">Tax Status</th>
                                <th style="width: 3%;">Employee Status</th>
                                <th style="width: 3%;">Government Status</th>
                                <th style="width: 5%;">Notes</th>
                                <th style="width: 7%;">Created Date</th>
                                <th style="width: 7%;">Updated Date</th>
                                <th style="width: 5%;">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in tx_data %}
                            <tr>
                            <td>{{ forloop.counter }}</td>
                             
                                
                                <td>{{row.6}}</td>
                                <td>₹{{row.12}}</td>
                                <td>₹{{row.14}}</td>
                                <td>₹{{row.15}}</td>
                                <td>{{row.13}}</td>
                                <td>{% if row.16 != None  %}
                                    
                                    {{row.16|date:'Y-m-d'}}
                                    
                                    {% else %}--
                                    {% endif %}
                                </td>
                            
                            
                                <td> 
                                    {% if row.17 == 'Approve' %}
                                 <span class="label-success label label-default">{{row.17}}</span>
                                {% else %}
                                <span class="label-danger label label-default">{{row.17}}</span>
                                {% endif %}
                                
                            </td>
                            <td> 
                                {% if row.18 == 'Active' %}
                             <span class="label-success label label-default">{{row.18}}</span>
                            {% else %}
                            <span class="label-danger label label-default">{{row.18}}</span>
                            {% endif %}
                            
                        </td>
                        <td> 
                            {% if row.19 == 'Active' %}
                         <span class="label-success label label-default">{{row.19}}</span>
                        {% else %}
                        <span class="label-danger label label-default">{{row.19}}</span>
                        {% endif %}
                        
                    </td>
                        <td style="word-wrap: break-word;">{% if row.20 != None  and row.20 != "None" %} {{row.20}} {% else %} -- {% endif %}</td>
                                
                                <td>{{row.21|date:'Y-m-d H:i:s'}}</td>
                                <td>{{row.22|date:'Y-m-d H:i:s'}}</td>
                                
                                <td>
                                    {% if row.18 == 'Active' and row.19 == 'Active' and row.17 == 'Approve' and row.16 != None %}
                                    <a href="#" class="btn btn-primary btn-sm download-btn" data-id="{{ row.0 }}" style="margin:5px;">
                                        <i class="fa fa-download"></i>
                                    </a>
                                    {% else %}
                                    <span class="label-primary label label-default">Waiting For Approval</span>
                                    
                                    {% endif %}

                                </td>
                                </tr>
                                {% empty %}
                                <tr><td colspan="12" style="text-align: center;"> Your Certificate is Empty .!</td></tr>
                                {% endfor %}
                                
                        </tbody>
                    </table>
                </div>
         </div>

        </div>

    </div>
  	
	<!-- Modal for password -->
    <div class="modal" id="passwordModal" tabindex="-1" role="dialog" aria-labelledby="passwordModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="passwordModalLabel" style="color: red;">Verification For Download Certificate </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <label style="float: left;">Enter Password</label>
                    <input type="password" id="password" class="form-control" placeholder="Enter password">
                    <label style="float: left;"><input type="checkbox" id="myInput" onclick="myFunction()"> Show Password</label>
                    <br/> 
                    <span id="error-message">Incorrect password, please try again.</span>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="submitPassword">Submit</button>
                </div>
            </div>
        </div>
    </div>
     <!-- JavaScript for password modal and validation -->
     <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
     <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    
     <script>
         document.querySelectorAll('.download-btn').forEach(button => {
             button.addEventListener('click', function (e) {
                 e.preventDefault();
                 var b_id = this.getAttribute('data-id'); // Get the ID of the current row
                 $('#passwordModal').modal('show'); // Show the modal
    
                 // Set the submit button action
                 document.getElementById('submitPassword').onclick = function () {
                     var password = document.getElementById('password').value; // Get entered password
                    
                     // AJAX call to check the password
                     fetch('check-password', {
                         method: 'POST',
                         headers: {
                             'Content-Type': 'application/json',
                             'X-CSRFToken': '{{ csrf_token }}', // CSRF token for security
                         },
                         body: JSON.stringify({
                             'password': password,
                         })
                     })
                     .then(response => response.json())
                     .then(data => {
                         if (data.success) {
                             window.location.href = `/utaxcertificate?b_id=${b_id}`; // Redirect to the download URL
                         } else {
                             document.getElementById('error-message').style.display = 'block'; // Show error message
                         }
                     })
                     .catch(error => console.error('Error:', error));
                 };
             });
         });
    
         function myFunction() {
              var x = document.getElementById("password");
              if (x.type === "password") {
                x.type = "text";
              } else {
                x.type = "password";
              }
            }
     </script>
    


	<!--end-->

<!-- jp footer Wrapper End -->
{% include 'ufooter.html' %}
<!--main js file start-->
{% include 'uscript.html' %}
<!--main js file end-->
</body>

</html>